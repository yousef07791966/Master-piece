<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"> 



        <!-- Libraries Stylesheet -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
        <link href="lib/animate/animate.min.css" rel="stylesheet">
        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
        <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">


    
      <!-- Favicon -->
      <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">
    
      <!-- CSS 
      ========================= -->
      <!--bootstrap min css-->
      <link rel="stylesheet" href="assets/css/bootstrap.min.css">
      <!--owl carousel min css-->
      <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
      <!--slick min css-->
      <link rel="stylesheet" href="assets/css/slick.css">
      <!--magnific popup min css-->
      <link rel="stylesheet" href="assets/css/magnific-popup.css">
      <!--font awesome css-->
      <link rel="stylesheet" href="assets/css/font.awesome.css">
      <!--ionicons min css-->
      <link rel="stylesheet" href="assets/css/ionicons.min.css">
      <!--animate css-->
      <link rel="stylesheet" href="assets/css/animate.css">
      <!--jquery ui min css-->
      <link rel="stylesheet" href="assets/css/jquery-ui.min.css">
      <!--slinky menu css-->
      <link rel="stylesheet" href="assets/css/slinky.menu.css">
      <!--plugins css-->
      <link rel="stylesheet" href="assets/css/plugins.css">
      
      <!-- Main Style CSS -->
      <link rel="stylesheet" href="assets/css/style.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      <!--modernizr min js here-->
      <script src="assets/js/vendor/modernizr-3.7.1.min.js"></script>
          <!-- Customized Bootstrap Stylesheet -->
          <link href="css/bootstrap.min.css" rel="stylesheet">

          <link href="css/style.css" rel="stylesheet">
</head>
<body>
          <!-- Navbar & Hero Start -->
          <div class="container-fluid sticky-top px-0" style="direction: rtl;">
            <nav class="navbar navbar-expand-lg navbar-dark bg-light py-3 px-4">
                <a href="index.html" class="navbar-brand p-0">
                </a>
                <div class="logo">
                    <img src="logo/quds.png" alt="">
                </div>
                
                <h1 class="text-secondary display-6">القدس</h1>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                    <span class="fa fa-bars"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <div class="navbar-nav ms-auto pt-2 pt-lg-0">
                        <a href="index.html" class="nav-item nav-link">الصفحة الرئيسية</a>

                        <div  class="nav-item dropdown" >
                            <a style="color: #fff !important ;" href="#" class="nav-link dropdown-toggle text-dark" data-bs-toggle="dropdown">المنتجات </a>
                            <div class="dropdown-menu m-lg-0" id="category">
                            
                            </div>
                        </div>
                        <a href="about.html" class="nav-item nav-link">من نحن</a>
                        <a href="contact.html" class="nav-item nav-link">تواصل معنا</a>
                        <a href="register.html" class="nav-item nav-link">إنشاء حساب</a>
                    </div>
                    </div>
                    <div class="d-flex align-items-center flex-nowrap pt-3  pt-lg-0 ms-lg-2">
                        <button class="btn btn-primary py-2 px-3" data-bs-toggle="modal" data-bs-target="#searchModal"><i class="fas fa-search"></i></button>
                    </div>
                    <a href="cart.html"class="btn btn-primary py-2 px-3"><i class="fa fa-shopping-cart ms-2"></i></a></a>

                </div>
            </nav>
        </div>
        <!-- Navbar & Hero End -->

     <!-- my account start  -->
     <section class="main_content_area">
      <div class="container">
        <div class="account_dashboard">
          <div class="row">
            <div class="col-sm-12 col-md-3 col-lg-3">
              <!-- Nav tabs -->
              <div class="dashboard_tab_button">
                <ul role="tablist" class="nav flex-column dashboard-list">
                  <li>
                    <a href="#" data-bs-toggle="tab" class="nav-link active"
                      >Dashboard</a
                    >
                  </li>
                  <li>
                    <a href="#orders" data-bs-toggle="tab" class="nav-link "
                      >Orders</a
                    >
                  </li>
                
                 
                  <li>
                    <a
                      href="#account-details"
                      data-bs-toggle="tab"
                      class="nav-link"
                      >Account details</a
                    >
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-sm-12 col-md-9 col-lg-9">
              <!-- Tab panes -->
              <div class="tab-content dashboard_content">
                <div class="tab-pane fade show active" id="dashboard">
                  <h3>Dashboard</h3>
                  <p>
                    From your account dashboard. you can easily check &amp; view
                    your <a href="#">recent orders</a>, manage your
                    <a href="#">shipping and billing addresses</a> and
                    <a href="#">Edit your password and account details.</a>
                  </p>
                </div>
                <div class="tab-pane fade" id="orders">
                  <h3>Orders</h3>
                  <div class="table-responsive">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>name</th>
                          <th>Total</th>
                          <th>email</th>
                          <th>Status</th>
                          <th>View</th>
                        </tr>
                      </thead>
                      <tbody id="container">
                      
                      </tbody>
                    </table>
                  </div>
                </div>
                </div>
                <div class="tab-pane fade" id="downloads">
                  <h3>Downloads</h3>
                  <div class="table-responsive">
                    <table class="table" >
                      <thead>
                        <tr>
                          <th>Product</th>
                          <th>Price</th>
                          <th>Brand</th>
                          <th>Quantity</th>
                          <th>Download</th>
                        </tr>
                      </thead>
                      <tbody id="downloadsTable">
                        
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <div class="tab-pane fade" id="account-details">
                  <h3>Account details</h3>
                  <div class="login">
                    <div class="login_form_container">
                      <div class="account_login_form">
                        <form id="editProfileForm">
                          <br />
                          <label>Full Name</label>
                          <input type="text" name="Name" id="name" />

                          <label>Email</label>
                          <input type="email" name="Email" id="email" />

                          <label>Password</label>
                          <input
                            type="password"
                            name="Password"
                            id="password"
                          />

                          <label>Confirm Password</label>
                          <input
                            type="password"
                            name="confirm-password"
                            id="confirm-password"
                          />

                          <label>Your Address</label>
                          <input type="text" name="Address" id="addrress" />

                          <label>Phone Number</label>
                          <input
                            type="text"
                            name="PhoneNumber"
                            id="phone-number"
                          />

                          <br />
                          <div class="save_button primary_btn default_button">
                            <button type="button" class="btn btn-danger" onclick="submitEditProfile()">
                              Save
                            </button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- my account end   -->

      
<!-- Footer Start -->
<div class="container-fluid footer py-5 wow fadeIn" data-wow-delay="0.2s">
    <div class="container py-5">
        <div class="row g-5">
            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    
                    <!-- <div class="footer-item">
                        <h4 class="text-white mb-4">Newsletter</h4>
                        <p class="mb-3">Dolor amet sit justo amet elitr clita ipsum elitr est.Lorem ipsum dolor sit amet, consectetur adipiscing elit consectetur adipiscing elit.</p>
                        <div class="position-relative mx-auto">
                            <input class="form-control w-100 py-3 ps-4 pe-5" type="text" placeholder="Enter your email">
                            <button type="button" class="btn btn-secondary position-absolute top-0 end-0 py-2 mt-2 me-2">SignUp</button>
                        </div>
                    </div> -->
                </div>
            </div>
            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4"></h4>
                    <a href="index.html"><i class="fas fa-angle-right me-2"></i> الصفحة الرئيسية</a>
                    <!-- <a href="#"><i class="fas fa-angle-right me-2"></i> Services</a> -->
                    <a href="about.html"><i class="fas fa-angle-right me-2"></i> من نحن</a>
                    <!-- <a href="#"><i class="fas fa-angle-right me-2"></i> Latest Projects</a> -->
                    <!-- <a href="#"><i class="fas fa-angle-right me-2"></i> testimonial</a> -->
                    <!-- <a href="#"><i class="fas fa-angle-right me-2"></i> Our Team</a> -->
                    <a href="contact.html"><i class="fas fa-angle-right me-2"></i> التواصل معنا</a><br>
                    <span><div class="footer-btn d-flex align-items-center">
                        <a class="btn btn-secondary btn-md-square me-2" href="https://www.facebook.com/thabetghazaleh?mibextid=ZbWKwL"><i class="fab fa-facebook-f text-white"></i></a>
                        <a class="btn btn-secondary btn-md-square me-2" href=""><i class="fab fa-twitter text-white"></i></a>
                        <a class="btn btn-secondary btn-md-square me-2" href=""><i class="fab fa-instagram text-white"></i></a>
                        <a class="btn btn-secondary btn-md-square me-0" href=""><i class="fab fa-linkedin-in text-white"></i></a>
                    </div></span> 
                </div>
            </div>
            <!-- <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4">Our Services</h4>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> General Construction</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Property Maintenance</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Project Managment</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Virtual Design & Build</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Residential Construction</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Preconstruction</a>
                    <a href="#"><i class="fas fa-angle-right me-2"></i> Design Build</a>
                </div>
            </div> -->
            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4"></h4>
                    <a href=""><i class="fa fa-map-marker-alt me-2"></i> عمان - الأردن</a>
                    <a href=""><i class="fas fa-envelope me-2"></i> Alquds@gmail.com</a>
                    <a href=""><i class="fas fa-phone me-2"></i> +962 780781333</a>
                    <a href="" class="mb-3"><i class="fas fa-print me-2"></i> +962 779196664</a><br>
                  
                </div>
                
            </div>
            
        </div>
        
    </div>
    
  </div>
  <!-- Footer End -->
  
  
          <!-- Back to Top -->
          <a href="#" class="btn btn-secondary btn-lg-square back-to-top"><i class="fa fa-arrow-up"></i></a>   
  

          <!-- Chat Div -->
<div class="chat-icon" id="chat-icon">
    <i class="fa fa-comments"></i>
  </div>
  
  <!-- نافذة الـ Chat -->
  <!-- <div class="chat-box" id="chat-box">
    <div class="chat-header">
        <h4>Messages</h4>
        <span id="close-chat" class="close-chat">&times;</span>
    </div>
    <div class="chat-body" id="chat-body">
    </div>
    <div class="chat-footer">
        <input type="text" id="chat-input" placeholder="Type a message..." />
        <button id="send-btn">Send</button>
    </div>
  </div> -->
  <script>
  function downloadExcel() {
        
    // Select the table element
    var wb = XLSX.utils.table_to_book(document.querySelector(".table"), {
      sheet: "Sheet1",
    });
    // Generate a binary string
    var wbout = XLSX.write(wb, { bookType: "xlsx", type: "binary" });

    // Convert binary string to array buffer
    function s2ab(s) {
      var buf = new ArrayBuffer(s.length);
      var view = new Uint8Array(buf);
      for (var i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xff;
      return buf;
    }

    // Create a Blob object and trigger download
    var blob = new Blob([s2ab(wbout)], { type: "application/octet-stream" });
    var link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "table.xlsx";
    link.click();
  }

  //////////////////////////////////////////////////////////////////

  var userID = localStorage.getItem("UserId");
  console.log(userID);
  const url = `https://localhost:44350/api/Order/download-order/${userID}`;

  async function getdata() {
    const requst = await fetch(url);
    const response = await requst.json();
    console.log(response);
    var continer = document.getElementById("container");

    response.forEach((element) => {
      continer.innerHTML += `
 <tr>
   
      <td>${element.name}</td>
      <td>${element.amount} </td>
      <td>${element.email} </td>
      <td>${statuse(element.status)} </td>
     <td><button class="download-btn" onclick="downloadOrder(${element.orderId})">
                <i class="fa fa-download"></i> Download
              </button></td>
  <tr>

      `;
    });
  }
  getdata();
  function statuse(status) {
      if (status === 0) {
        return "Pending";
      } else if (status === 1) {
        return "Delivered";
      } else {
        return "Cancelled";
      }
  }
  async function loadDownloadData(orderId) {
  try {
    debugger
    event.preventDefault();
    const response = await fetch(`https://localhost:44350/api/Order/download-orderItems/${orderId}`);
    if (!response.ok) {
      throw new Error("Failed to fetch download data");
    }
    const data = await response.json();
    console.log(data);

    // Inject data into the #downloadsTable
    const tableBody = document.getElementById("downloadsTable");
    tableBody.innerHTML = ""; // Clear previous content

    data.forEach(item => {
      tableBody.innerHTML += `
        <tr>
          <td>${item.productName}</td>
          <td>${item.productPrice}</td>
          <td>${item.productBrand}</td>
          <td>${item.orderQuantity}</td>
          <td><a class="view">Download</a></td>
        </tr>`
      ;
    });

  } catch (error) {
    console.error("Error fetching download data: ", error);
  }
}




///////////////////////////////////////////////////////////////////////////////////////

async function downloadOrder(orderId) {
  debugger
    const url = `https://localhost:44350/api/Order/GenerateInvoice?orderId=${orderId}`;

    const link = document.createElement("a");
    link.href = url;
    link.download = `invoice_${orderId}.pdf`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
  ////////////////////////////////////////////////////////////////////

// Function to smoothly scroll to the #downloads section
function smoothScrollToDownloads() {
  const downloadsSection = document.querySelector("#downloads");
  if (downloadsSection) {
    downloadsSection.scrollIntoView({ behavior: "smooth" });
  } else {
    console.error("#downloads section not found");
  }
}

// Function to load data and scroll to the #downloads section
async function loadDownloadDataAndScroll(orderId) {
  await loadDownloadData(orderId); // Wait for data to load
  smoothScrollToDownloads(); // Scroll smoothly to #downloads section
}
    </script>
          
         <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    
    <script src="js/getCategoryOptions.js"></script>
    <!-- Template Javascript -->
    <script src="js/main.js"></script>
     
  </body>
  </html>